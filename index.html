<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>勇气阶梯 - 焦虑暴露记录器</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>🧘‍♂️ 勇气阶梯 (Courage Ladder)</h1>
    </header>

    <main id="login-view" class="main-container">
        <div class="card login-card-box">
            <h2>欢迎使用勇气阶梯</h2>
            <p>这款工具将帮助您系统地跟踪和管理您的暴露疗法进度。</p>
            <input type="text" id="codename-input" placeholder="请输入你的练习代号，例如：勇者一号" required>
            <button id="login-button" class="button-primary">登录 / 开始</button>
        </div>
    </main>

    <main id="app-view" class="main-container" style="display: none;">
        
        <h2 id="welcome-message" style="text-align: center; margin-bottom: 10px;"></h2>

        <div class="card ethics compact">
            <div class="ethics-content">
                <span class="ethics-icon">⚠️</span>
                <span class="ethics-text">
                    <strong>伦理声明：</strong> 本工具仅为课程作业，不可替代专业治疗。
                    <strong>黄金法则：</strong> 暴露练习时请坚持至焦虑下降 50% 再结束，切勿逃避。
                </span>
            </div>
        </div>

        <div class="app-layout">

            <div class="calendar-column">
                <div class="card calendar-card">
                    <h3>🗓️ 勇气日历</h3>
                    <p>记录您添加任务的足迹：</p>
                    <div id="calendar-container">
                        </div>
                    <p class="calendar-legend">🔴 = 点击查看当日任务</p>
                </div>
            </div>

            <div class="main-column">
                
                <div class="card">
                    <h3>🪜 第一步: 添加新阶梯</h3>
                    <form id="add-item-form">
                        <input type="text" id="item-name" placeholder="情境 (例如: 在镜子前演讲)" required>
                        <button type="submit">添加并评估难度</button>
                    </form>
                </div>

                <div class="card">
                    <h3>🪜 你的勇气阶梯</h3>
                    <div id="ladder-container">
                        <p>你的阶梯还是空的...</p>
                    </div>
                </div>

                <div class="card">
                    <h3>📈 进展分析报告</h3>
                    <div id="report-container" class="report-box report-default">
                        <p>当你记录一次练习后，分析报告将显示在这里。</p>
                    </div>
                </div>

            </div>

            <div class="sidebar-column">
                
                <div class="card ai-card">
                    <h3>🤖 智能 AI 助手</h3>
                    <p>请描述你现在的感受或困扰：</p>
                    <form id="ai-form">
                        <textarea id="ai-input" placeholder="例如：“我感觉心跳很快，停不下来...”" required></textarea>
                        <button type="submit" class="button-primary" id="ai-submit-button">获取 AI 建议</button>
                    </form>
                </div>

                <div class="card coping-card">
                    <h3>📦 你的 AI 建议</h3>
                    <p id="coping-instructions">AI 的建议将会“刷新”到这里。</p>
                    
                    <ul id="coping-toolkit">
                        </ul>

                    <div id="satisfaction-panel" class="satisfaction-panel" style="display:none;">
                        <hr>
                        <p>❓ 你是否感觉困惑有所缓解？</p>
                        <div class="modal-buttons justify-content-center">
                            <button id="solve-yes" class="button-primary" disabled>是，已经解决了！</button>
                            <button id="solve-no" class="button-secondary" disabled>否，我需要新的建议</button>
                        </div>
                    </div>
                    
                    <div id="coping-feedback"></div>
                </div>

                <div class="card" style="padding: 15px; text-align: center;">
                    <button id="show-instructions" class="button-secondary">再次查看使用说明</button>
                </div>

            </div> 

        </div> 
    </main>

    <dialog id="suds-modal">
        <form id="suds-form">
            <h3 id="modal-title">评估焦虑程度</h3>
            <div class.card" id="suds-guide">
                <strong>请参考以下“锚点”来打分 (0-10):</strong>
                <ul>
                    <li><b>10:</b> 极度恐慌，是我能想象的最糟糕状态。</li>
                    <li><b>8:</b> 非常强烈的焦虑，很难专注，急切想逃离。</li>
                    <li><b>5:</b> 中等程度的焦虑，明显的不适感，需刻意镇定。</li>
                    <li><b>2:</b> 轻微的焦虑，可察觉，但完全可控。</li>
                    <li><b>0:</b> 绝对的平静，完全没有焦虑。</li>
                </ul>
            </div>

            <div id="peak-input-group">
                <label for="peak-suds">【峰值】焦虑 (0-10):</label>
                <input type="number" id="peak-suds" min="0" max="10" required>
            </div>
            
            <div id="final-input-group">
                <label for="final-suds">【结束时】焦虑 (0-10):</label>
                <input type="number" id="final-suds" min="0" max="10" required>
            </div>

            <div id="reflection-group">
                <label for="reflection-text">本次练习的“感悟” (选填):</label>
                <textarea id="reflection-text" placeholder="例如: “刚开始很难，但5分钟后我发现自己平静下来了...”"></textarea>
            </div>

            <div class="modal-buttons">
                <button type="submit" class="button-primary">保存记录</button>
                <button type="button" id="modal-cancel-button" class="button-secondary">取消</button>
            </div>
        </form>
    </dialog>

    <dialog id="calendar-details-modal" class="mini-modal">
        <div class="modal-header">
            <h4 id="calendar-details-date">日期</h4>
            <button id="close-calendar-details" class="close-icon">×</button>
        </div>
        <div class="modal-body">
            <p style="margin-bottom: 10px; font-size: 0.9em; color: #666;">当天添加了以下恐惧任务：</p>
            <ul id="calendar-details-list">
                </ul>
        </div>
    </dialog>

    <dialog id="welcome-modal">
        <h3>👋 欢迎使用：勇气阶梯</h3>
        <p>把这里当成你的 **“恐惧焦虑日记本”** 吧！</p>
        <ol>
            <li>**分解焦虑** 💔 → 🪜：把让你害怕的大目标，拆解成一个个小的“阶梯任务”。</li>
            <li>**记录和追踪** 📝：完成任务后，记录你的 **“峰值焦虑”** 和 **“结束焦虑”**，追踪每次的进步。</li>
            <li>**寻求帮助** 🤖：感到焦虑时，向 **AI 助手**描述你的感受，它会给你即时的 **应对技巧**！</li>
            <li>**日历提醒** 🗓️：点击日历上的 **🔴 红点**，查看你在那天挑战了哪些新恐惧。</li>
        </ol>
        <div class="modal-buttons">
            <button id="close-welcome-button" class="button-primary">我明白了，开始使用</button>
        </div>
    </dialog>

    <script src="script.js"></script>
</body>
</html>